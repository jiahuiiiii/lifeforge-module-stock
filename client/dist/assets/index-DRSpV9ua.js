import{importShared as p}from"./__federation_fn_import-E6wRZccp.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{k as M,B as $,X as w,Y as k,l as C,R as N,m as S,T,p as A,o as b}from"./chunk-HTB5LLOP-BF-XgM01.js";import{f as D}from"./forgeAPI-DuNy0l6-.js";var I=M({chartName:"BarChart",GraphicalChild:$,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:w},{axisType:"yAxis",AxisComp:k}],formatAxisMap:C});const{Card:W}=await p("lifeforge-ui"),{useState:F}=await p("react"),{usePersonalization:O}=await p("shared"),B=({active:m,payload:i})=>{if(m&&i&&i.length){const s=i[0].payload;return e.jsxs(W,{className:"border-bg-200 dark:border-bg-700/50 border",children:[e.jsx("p",{className:"mb-2 font-semibold",children:s.date}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-bg-500 font-medium",children:"Open:"})," $",s.open.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-bg-500 font-medium",children:"High:"})," $",s.high.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-bg-500 font-medium",children:"Low:"})," $",s.low.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-bg-500 font-medium",children:"Close:"})," $",s.close.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-bg-500 font-medium",children:"Volume:"})," ",s.volume.toLocaleString()]})]})]})}return null};function R(m){const{x:i,y:s,width:c,height:d,low:u,high:x,openClose:f,background:l,bgTempPalette:n,isActive:g}=m;if(!f)return null;const[a,h]=f,r=a<h,t=r?b.green[500]:b.red[500],o=Math.abs(d/(a-h));return e.jsxs("g",{children:[g&&l&&e.jsx("rect",{fill:n?.[500]||b.gray[500],fillOpacity:.2,height:l.height,width:l.width,x:l.x,y:l.y}),e.jsxs("g",{fill:t,stroke:t,strokeWidth:"1",children:[e.jsx("path",{d:`
            M ${i},${s}
            L ${i},${s+d}
            L ${i+c},${s+d}
            L ${i+c},${s}
            Z
          `}),r?e.jsx("path",{d:`
              M ${i+c/2}, ${s+d}
              v ${(a-u)*o}
            `}):e.jsx("path",{d:`
              M ${i+c/2}, ${s}
              v ${(h-u)*o}
            `}),r?e.jsx("path",{d:`
              M ${i+c/2}, ${s}
              v ${(h-x)*o}
            `}):e.jsx("path",{d:`
              M ${i+c/2}, ${s+d}
              v ${(a-x)*o}
            `})]})]})}function Y({data:m,symbol:i}){const{bgTempPalette:s,derivedTheme:c}=O(),[d,u]=F(null),x=[...m].reverse(),l=(t=>t<=5?20:t<=30?12:t<=90?8:t<=180?6:t<=365?4:3)(x.length),n=x.map(t=>({...t,openClose:[t.open,t.close],candleWidth:l})),g=n.reduce((t,o)=>{const j=Math.min(o.low,o.open,o.close);return j<t?j:t},n[0]?.low||0),a=n.reduce((t,o)=>{const j=Math.max(o.high,o.open,o.close);return j>t?j:t},n[0]?.high||0),h=(a-g)*.1,r=[g-h,a+h];return e.jsx("div",{className:"w-full flex-1",children:e.jsx(N,{height:"100%",width:"100%",children:e.jsxs(I,{data:n,margin:{bottom:20,left:10,right:20,top:20},onMouseLeave:()=>u(null),onMouseMove:t=>{t.activeTooltipIndex!==void 0&&u(t.activeTooltipIndex)},children:[e.jsx(S,{stroke:c==="light"?s[300]:s[700],strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"date",tick:{fontSize:12},tickFormatter:t=>{const o=new Date(t);return x.length>180?`${o.getMonth()+1}/${o.getDate()}/${o.getFullYear().toString().slice(-2)}`:`${o.getMonth()+1}/${o.getDate()}`}}),e.jsx(k,{domain:r,tick:{fontSize:12},tickFormatter:t=>t.toFixed(2)}),e.jsx(T,{content:e.jsx(B,{}),cursor:!1}),e.jsx($,{dataKey:"openClose",shape:t=>e.jsx(R,{...t,bgTempPalette:s,isActive:d===t.index}),children:n.map((t,o)=>e.jsx(A,{},`cell-${o}`))})]})})})}const{useQuery:_}=await p("@tanstack/react-query"),{Button:E,GoBackButton:P,WithQuery:V}=await p("lifeforge-ui"),{useMemo:y,useState:v}=await p("react"),{useNavigate:z,useParams:G}=await p("shared");function K(){const m=z(),{symbolAndName:i}=G(),[s,c]=i?.split("||")??[],[d,u]=v("1M"),[x,f]=v(0),l=_(D.getStock.input({symbol:s??""}).queryOptions({enabled:!!s})),n=y(()=>x>=0&&JSON.parse(localStorage.getItem("stock_watchlist")||"[]").some(a=>a.symbol===s),[s,x]),g=y(()=>{if(!l.data?.data)return[];const a=l.data.data,r={"1D":1,"5D":5,"1M":30,"3M":90,"6M":180,"1Y":365,"5Y":1825}[d];return a.slice(0,r)},[l.data,d]);return e.jsxs("div",{className:"flex size-full flex-1 animate-[fadeSlideIn_0.3s_ease-out] flex-col",children:[e.jsx(P,{onClick:()=>m(-1)}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold",children:s}),e.jsx("p",{className:"text-bg-500",children:c})]}),e.jsx(E,{as:"button",dangerous:n,icon:n?"tabler:eye-off":"tabler:eye",variant:n?"plain":"secondary",onClick:()=>{const a=JSON.parse(localStorage.getItem("stock_watchlist")||"[]");if(a.some(r=>r.symbol===s)){const r=a.filter(t=>t.symbol!==s);localStorage.setItem("stock_watchlist",JSON.stringify(r))}else a.push({symbol:s,name:c,addedAt:new Date().toISOString()}),localStorage.setItem("stock_watchlist",JSON.stringify(a));f(r=>r+1),window.dispatchEvent(new Event("storage"))},children:n?"Remove from Watchlist":"Add to Watchlist"})]}),e.jsxs("div",{className:"my-6 flex items-center gap-2",children:[e.jsx("span",{className:"text-bg-500 text-sm",children:"Time Range:"}),e.jsx("div",{className:"bg-bg-200 dark:bg-bg-700 flex rounded-lg p-0.5",children:["1D","5D","1M","3M","6M","1Y","5Y"].map(a=>e.jsx("button",{className:`rounded px-2.5 py-1 text-xs font-medium transition-colors ${d===a?"bg-bg-50 text-bg-900 dark:bg-bg-800 dark:text-bg-100 shadow-sm":"text-bg-500 hover:text-bg-700 dark:hover:text-bg-300"}`,type:"button",onClick:()=>u(a),children:a},a))})]}),e.jsx(V,{query:l,children:()=>e.jsx(Y,{data:g,symbol:s})})]})}export{K as default};
