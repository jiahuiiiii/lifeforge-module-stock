import{importShared as O}from"./__federation_fn_import-E6wRZccp.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{I as H}from"./iconify-CHsp7AQ2.js";import{f as re}from"./forgeAPI-DuNy0l6-.js";import{i as Ie,D as Le,f as Te,E as Me,L as ae,a as J,C as $e,A as Ee,b as Y,c as _e,d as se,h as Fe,e as He,g as Ae,u as Be,G as ze,j as ce,k as Re,X as Se,Y as we,l as Ve,R as We,m as Ye,T as Ue,n as qe,o as Ke}from"./chunk-HTB5LLOP-BF-XgM01.js";import{c as de}from"./clsx-B-dksMZM.js";import{c as Qe,p as Ge}from"./middleware-B78Bpy5V.js";const{Button:ue,Card:Xe}=await O("lifeforge-ui"),{useState:U}=await O("react");function Je({isOpen:r,onClose:n,onAdd:a}){const[t,s]=U(""),[o,i]=U(""),[l,d]=U(""),[f,x]=U(""),[h,m]=U(new Date().toISOString().split("T")[0]),b=()=>{const u=parseFloat(l),y=parseFloat(f);!t.trim()||u<=0||y<=0||(a({symbol:t.toUpperCase().trim(),name:o.trim()||t.toUpperCase().trim(),shares:u,avgCost:y,dateAdded:new Date(h).toISOString()}),s(""),i(""),d(""),x(""),m(new Date().toISOString().split("T")[0]),n())},p=t.trim()&&parseFloat(l)>0&&parseFloat(f)>0&&h;return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(Xe,{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"bg-custom-500/20 flex size-12 items-center justify-center rounded-lg",children:e.jsx(H,{className:"text-custom-500 size-6",icon:"tabler:plus"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Add Holding"}),e.jsx("p",{className:"text-bg-500 text-sm",children:"Add a stock to your portfolio"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Stock Symbol"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"e.g., AAPL",value:t,onChange:u=>s(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Company Name (optional)"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",placeholder:"e.g., Apple Inc.",value:o,onChange:u=>i(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Date Added"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",max:new Date().toISOString().split("T")[0],type:"date",value:h,onChange:u=>m(u.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Number of Shares"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",min:"0.0001",placeholder:"e.g., 100",step:"0.0001",type:"number",value:l,onChange:u=>d(u.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Avg Cost per Share"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",min:"0.01",placeholder:"e.g., 150.00",step:"0.01",type:"number",value:f,onChange:u=>x(u.target.value)})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(ue,{className:"flex-1",variant:"secondary",onClick:n,children:"Cancel"}),e.jsx(ue,{className:"flex-1",disabled:!p,icon:"tabler:plus",onClick:b,children:"Add Holding"})]})]})}):null}const{Button:me,Card:Ze}=await O("lifeforge-ui"),{useEffect:et,useState:ne}=await O("react");function tt({isOpen:r,holding:n,onClose:a,onSave:t}){const[s,o]=ne(""),[i,l]=ne(""),[d,f]=ne("");et(()=>{n&&(o(n.shares.toString()),l(n.avgCost.toString()),f(n.dateAdded.split("T")[0]))},[n]);const x=()=>{if(!n)return;const m=parseFloat(s),b=parseFloat(i);m<=0||b<=0||(t(n.id,{shares:m,avgCost:b,dateAdded:new Date(d).toISOString()}),a())},h=parseFloat(s)>0&&parseFloat(i)>0&&d;return!r||!n?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs(Ze,{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"bg-custom-500/20 flex size-12 items-center justify-center rounded-lg",children:e.jsx(H,{className:"text-custom-500 size-6",icon:"tabler:edit"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Edit Holding"}),e.jsxs("p",{className:"text-bg-500 text-sm",children:[n.symbol," - ",n.name]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Date Added"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",max:new Date().toISOString().split("T")[0],type:"date",value:d,onChange:m=>f(m.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Number of Shares"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",min:"0.0001",placeholder:"e.g., 100",step:"0.0001",type:"number",value:s,onChange:m=>o(m.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-bg-500 mb-1 block text-sm",children:"Avg Cost per Share"}),e.jsx("input",{className:"border-bg-200 bg-bg-50 dark:border-bg-700 dark:bg-bg-900 w-full rounded-lg border px-3 py-2 text-sm",min:"0.01",placeholder:"e.g., 150.00",step:"0.01",type:"number",value:i,onChange:m=>l(m.target.value)})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(me,{className:"flex-1",variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(me,{className:"flex-1",disabled:!h,icon:"tabler:check",onClick:x,children:"Save Changes"})]})]})})}const{Button:fe,Card:rt,ConfirmationModal:at,useModalStore:nt}=await O("lifeforge-ui");function st({holdings:r,onRemove:n,onEdit:a,isLoading:t}){const{open:s}=nt();return r.length===0?null:e.jsx(rt,{className:"overflow-hidden p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"border-bg-200 bg-bg-100 dark:border-bg-700 dark:bg-bg-800 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Symbol"}),e.jsx("th",{className:"px-4 py-3 font-semibold",children:"Added On"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Shares"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Avg Cost"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Current Price"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"Market Value"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"P/L"}),e.jsx("th",{className:"px-4 py-3 text-right font-semibold",children:"P/L %"}),e.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(o=>{const i=o.shares*o.currentPrice,l=o.shares*o.avgCost,d=i-l,f=l>0?d/l*100:0,x=d>=0;return e.jsxs("tr",{className:"border-bg-200 dark:border-bg-700 border-b last:border-b-0",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold",children:o.symbol}),e.jsx("div",{className:"text-bg-500 text-xs",children:o.name})]}),e.jsx("td",{className:"text-bg-500 px-4 py-3 text-sm",children:new Date(o.dateAdded).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:o.shares.toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["$",o.avgCost.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-right",children:t?e.jsx("span",{className:"text-bg-400",children:"Loading..."}):e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"font-medium",children:["$",o.currentPrice.toFixed(2)]}),e.jsxs("div",{className:`text-xs ${o.change>=0?"text-green-500":"text-red-500"}`,children:[o.change>=0?"+":"",o.change.toFixed(2)," (",o.changePercent.toFixed(2),"%)"]})]})}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:["$",i.toLocaleString("en-US",{minimumFractionDigits:2})]}),e.jsxs("td",{className:`px-4 py-3 text-right font-medium ${x?"text-green-500":"text-red-500"}`,children:[x?"+":"","$",d.toFixed(2)]}),e.jsxs("td",{className:`px-4 py-3 text-right font-medium ${x?"text-green-500":"text-red-500"}`,children:[x?"+":"",f.toFixed(2),"%"]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx(fe,{icon:"tabler:edit",variant:"plain",onClick:()=>a(o)}),e.jsx(fe,{dangerous:!0,icon:"tabler:trash",variant:"plain",onClick:()=>s(at,{title:"Remove Holding",description:`Remove ${o.symbol} from portfolio? This action cannot be undone.`,confirmationButton:"confirm",onConfirm:async()=>{n(o.id)}})})]})})]},o.id)})})]})})})}var ot=["type","layout","connectNulls","ref"],it=["key"];function V(r){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},V(r)}function pe(r,n){if(r==null)return{};var a=lt(r,n),t,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)t=o[s],!(n.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(r,t)&&(a[t]=r[t])}return a}function lt(r,n){if(r==null)return{};var a={};for(var t in r)if(Object.prototype.hasOwnProperty.call(r,t)){if(n.indexOf(t)>=0)continue;a[t]=r[t]}return a}function G(){return G=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(r[t]=a[t])}return r},G.apply(this,arguments)}function he(r,n){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);n&&(t=t.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),a.push.apply(a,t)}return a}function L(r){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?he(Object(a),!0).forEach(function(t){E(r,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):he(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}function z(r){return mt(r)||ut(r)||dt(r)||ct()}function ct(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dt(r,n){if(r){if(typeof r=="string")return oe(r,n);var a=Object.prototype.toString.call(r).slice(8,-1);if(a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set")return Array.from(r);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return oe(r,n)}}function ut(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function mt(r){if(Array.isArray(r))return oe(r)}function oe(r,n){(n==null||n>r.length)&&(n=r.length);for(var a=0,t=new Array(n);a<n;a++)t[a]=r[a];return t}function ft(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function xe(r,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,De(t.key),t)}}function pt(r,n,a){return n&&xe(r.prototype,n),a&&xe(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r}function ht(r,n,a){return n=te(n),xt(r,Ce()?Reflect.construct(n,a||[],te(r).constructor):n.apply(r,a))}function xt(r,n){if(n&&(V(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gt(r)}function gt(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Ce(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ce=function(){return!!r})()}function te(r){return te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},te(r)}function bt(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&ie(r,n)}function ie(r,n){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},ie(r,n)}function E(r,n,a){return n=De(n),n in r?Object.defineProperty(r,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[n]=a,r}function De(r){var n=vt(r,"string");return V(n)=="symbol"?n:n+""}function vt(r,n){if(V(r)!="object"||!r)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var t=a.call(r,n);if(V(t)!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}const D=await O("react"),{PureComponent:yt}=D;var W=(function(r){function n(){var a;ft(this,n);for(var t=arguments.length,s=new Array(t),o=0;o<t;o++)s[o]=arguments[o];return a=ht(this,n,[].concat(s)),E(a,"state",{isAnimationFinished:!0,totalLength:0}),E(a,"generateSimpleStrokeDasharray",function(i,l){return"".concat(l,"px ").concat(i-l,"px")}),E(a,"getStrokeDasharray",function(i,l,d){var f=d.reduce(function(A,S){return A+S});if(!f)return a.generateSimpleStrokeDasharray(l,i);for(var x=Math.floor(i/f),h=i%f,m=l-i,b=[],p=0,u=0;p<d.length;u+=d[p],++p)if(u+d[p]>h){b=[].concat(z(d.slice(0,p)),[h-u]);break}var y=b.length%2===0?[0,m]:[m];return[].concat(z(n.repeat(d,x)),z(b),y).map(function(A){return"".concat(A,"px")}).join(", ")}),E(a,"id",Be("recharts-line-")),E(a,"pathRef",function(i){a.mainCurve=i}),E(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0}),a.props.onAnimationEnd&&a.props.onAnimationEnd()}),E(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1}),a.props.onAnimationStart&&a.props.onAnimationStart()}),a}return bt(n,r),pt(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var t=this.getTotalLength();this.setState({totalLength:t})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var t=this.getTotalLength();t!==this.state.totalLength&&this.setState({totalLength:t})}}},{key:"getTotalLength",value:function(){var t=this.mainCurve;try{return t&&t.getTotalLength&&t.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(t,s){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,i=o.points,l=o.xAxis,d=o.yAxis,f=o.layout,x=o.children,h=Te(x,Me);if(!h)return null;var m=function(u,y){return{x:u.x,y:u.y,value:u.value,errorVal:Ae(u.payload,y)}},b={clipPath:t?"url(#clipPath-".concat(s,")"):null};return D.createElement(ae,b,h.map(function(p){return D.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:i,xAxis:l,yAxis:d,layout:f,dataPointFormatter:m})}))}},{key:"renderDots",value:function(t,s,o){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.dot,f=l.points,x=l.dataKey,h=J(this.props,!1),m=J(d,!0),b=f.map(function(u,y){var A=L(L(L({key:"dot-".concat(y),r:3},h),m),{},{index:y,cx:u.x,cy:u.y,value:u.value,dataKey:x,payload:u.payload,points:f});return n.renderDotItem(d,A)}),p={clipPath:t?"url(#clipPath-".concat(s?"":"dots-").concat(o,")"):null};return D.createElement(ae,G({className:"recharts-line-dots",key:"dots"},p),b)}},{key:"renderCurveStatically",value:function(t,s,o,i){var l=this.props,d=l.type,f=l.layout,x=l.connectNulls;l.ref;var h=pe(l,ot),m=L(L(L({},J(h,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:s?"url(#clipPath-".concat(o,")"):null,points:t},i),{},{type:d,layout:f,connectNulls:x});return D.createElement($e,G({},m,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(t,s){var o=this,i=this.props,l=i.points,d=i.strokeDasharray,f=i.isAnimationActive,x=i.animationBegin,h=i.animationDuration,m=i.animationEasing,b=i.animationId,p=i.animateNewValues,u=i.width,y=i.height,A=this.state,S=A.prevPoints,M=A.totalLength;return D.createElement(Ee,{begin:x,duration:h,isActive:f,easing:m,from:{t:0},to:{t:1},key:"line-".concat(b),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(w){var P=w.t;if(S){var _=S.length/l.length,$=l.map(function(j,N){var I=Math.floor(N*_);if(S[I]){var F=S[I],C=Y(F.x,j.x),le=Y(F.y,j.y);return L(L({},j),{},{x:C(P),y:le(P)})}if(p){var X=Y(u*2,j.x),Oe=Y(y/2,j.y);return L(L({},j),{},{x:X(P),y:Oe(P)})}return L(L({},j),{},{x:j.x,y:j.y})});return o.renderCurveStatically($,t,s)}var g=Y(0,M),c=g(P),v;if(d){var k="".concat(d).split(/[,\s]+/gim).map(function(j){return parseFloat(j)});v=o.getStrokeDasharray(c,M,k)}else v=o.generateSimpleStrokeDasharray(M,c);return o.renderCurveStatically(l,t,s,{strokeDasharray:v})})}},{key:"renderCurve",value:function(t,s){var o=this.props,i=o.points,l=o.isAnimationActive,d=this.state,f=d.prevPoints,x=d.totalLength;return l&&i&&i.length&&(!f&&x>0||!_e(f,i))?this.renderCurveWithAnimation(t,s):this.renderCurveStatically(i,t,s)}},{key:"render",value:function(){var t,s=this.props,o=s.hide,i=s.dot,l=s.points,d=s.className,f=s.xAxis,x=s.yAxis,h=s.top,m=s.left,b=s.width,p=s.height,u=s.isAnimationActive,y=s.id;if(o||!l||!l.length)return null;var A=this.state.isAnimationFinished,S=l.length===1,M=de("recharts-line",d),w=f&&f.allowDataOverflow,P=x&&x.allowDataOverflow,_=w||P,$=se(y)?this.id:y,g=(t=J(i,!1))!==null&&t!==void 0?t:{r:3,strokeWidth:2},c=g.r,v=c===void 0?3:c,k=g.strokeWidth,j=k===void 0?2:k,N=Fe(i)?i:{},I=N.clipDot,F=I===void 0?!0:I,C=v*2+j;return D.createElement(ae,{className:M},w||P?D.createElement("defs",null,D.createElement("clipPath",{id:"clipPath-".concat($)},D.createElement("rect",{x:w?m:m-b/2,y:P?h:h-p/2,width:w?b:b*2,height:P?p:p*2})),!F&&D.createElement("clipPath",{id:"clipPath-dots-".concat($)},D.createElement("rect",{x:m-C/2,y:h-C/2,width:b+C,height:p+C}))):null,!S&&this.renderCurve(_,$),this.renderErrorBar(_,$),(S||i)&&this.renderDots(_,F,$),(!u||A)&&He.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(t,s){return t.animationId!==s.prevAnimationId?{prevAnimationId:t.animationId,curPoints:t.points,prevPoints:s.curPoints}:t.points!==s.curPoints?{curPoints:t.points}:null}},{key:"repeat",value:function(t,s){for(var o=t.length%2!==0?[].concat(z(t),[0]):t,i=[],l=0;l<s;++l)i=[].concat(z(i),z(o));return i}},{key:"renderDotItem",value:function(t,s){var o;if(D.isValidElement(t))o=D.cloneElement(t,s);else if(Ie(t))o=t(s);else{var i=s.key,l=pe(s,it),d=de("recharts-line-dot",typeof t!="boolean"?t.className:"");o=D.createElement(Le,G({key:i},l,{className:d}))}return o}}])})(yt);E(W,"displayName","Line");E(W,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!ze.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});E(W,"getComposedData",function(r){var n=r.props,a=r.xAxis,t=r.yAxis,s=r.xAxisTicks,o=r.yAxisTicks,i=r.dataKey,l=r.bandSize,d=r.displayedData,f=r.offset,x=n.layout,h=d.map(function(m,b){var p=Ae(m,i);return x==="horizontal"?{x:ce({axis:a,ticks:s,bandSize:l,entry:m,index:b}),y:se(p)?null:t.scale(p),value:p,payload:m}:{x:se(p)?null:a.scale(p),y:ce({axis:t,ticks:o,bandSize:l,entry:m,index:b}),value:p,payload:m}});return L({points:h,layout:x},f)});var jt=Re({chartName:"LineChart",GraphicalChild:W,axisComponents:[{axisType:"xAxis",AxisComp:Se},{axisType:"yAxis",AxisComp:we}],formatAxisMap:Ve});const{Card:Q}=await O("lifeforge-ui"),{useMemo:Nt}=await O("react"),{usePersonalization:Pt}=await O("shared"),kt=({active:r,payload:n,label:a})=>r&&n&&n.length?e.jsxs(Q,{className:"border-bg-200 dark:border-bg-700/50 border",children:[e.jsx("p",{className:"mb-2 text-sm font-semibold",children:a}),n.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"size-2 rounded-full",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"text-bg-500",children:[t.name,":"]}),e.jsxs("span",{className:"font-medium",children:[t.value>=0?"+":"",t.value.toFixed(2),"%"]})]},s))]}):null;function At({portfolioData:r,portfolioName:n,benchmarkData:a,benchmarkSymbol:t,isLoading:s,range:o="1M",error:i}){const{bgTempPalette:l,derivedTheme:d,derivedThemeColor:f}=Pt(),x=Nt(()=>{if(r.length===0)return[];const h=r[0]?.value||0,m=a[0]?.value||0,b=new Map;for(const p of r){const u=h>0?(p.value-h)/h*100:0;b.set(p.date,{portfolio:u})}for(const p of a){const u=m>0?(p.value-m)/m*100:0,y=b.get(p.date)||{};b.set(p.date,{...y,benchmark:u})}return Array.from(b.entries()).map(([p,u])=>({date:p,portfolio:u.portfolio??null,benchmark:u.benchmark??null})).sort((p,u)=>new Date(p.date).getTime()-new Date(u.date).getTime())},[r,a]);if(i){const h=i.message.includes("API_PLAN_LIMIT");return e.jsx(Q,{children:e.jsxs("div",{className:"flex-center h-64 flex-col gap-2 text-center",children:[e.jsx("div",{className:"font-medium text-red-500",children:h?`Benchmark unavailable: ${t}`:"Failed to load benchmark data"}),e.jsx("div",{className:"text-bg-500 max-w-sm text-sm",children:h?"This index is not available on your current API plan. Please upgrade to view comparison data.":i.message})]})})}return s?e.jsx(Q,{children:e.jsx("div",{className:"flex-center h-64",children:e.jsx("div",{className:"text-bg-500",children:"Loading performance data..."})})}):x.length===0?e.jsx(Q,{children:e.jsx("div",{className:"flex-center h-64",children:e.jsx("div",{className:"text-bg-500",children:"No performance data available"})})}):e.jsxs(Q,{children:[e.jsxs("h3",{className:"mb-4 font-semibold",children:["Performance vs ",t]}),e.jsx("div",{className:"h-64",children:e.jsx(We,{height:"100%",width:"100%",children:e.jsxs(jt,{data:x,margin:{bottom:5,left:10,right:20,top:5},children:[e.jsx(Ye,{stroke:d==="light"?l[300]:l[700],strokeDasharray:"3 3"}),e.jsx(Se,{dataKey:"date",tick:{fontSize:11},tickFormatter:h=>{const m=new Date(h);return o==="1Y"||o==="ALL"?m.toLocaleDateString(void 0,{month:"short",year:"2-digit"}):o==="YTD"?m.toLocaleDateString(void 0,{month:"short",day:"numeric"}):`${m.getMonth()+1}/${m.getDate()}`}}),e.jsx(we,{tick:{fontSize:11},tickFormatter:h=>`${h.toFixed(0)}%`}),e.jsx(Ue,{content:e.jsx(kt,{})}),e.jsx(qe,{}),e.jsx(W,{connectNulls:!0,dataKey:"portfolio",dot:{r:3},name:n,stroke:f,strokeWidth:2,type:"monotone"}),e.jsx(W,{connectNulls:!0,dataKey:"benchmark",dot:!1,name:t,stroke:Ke.blue[500],strokeWidth:2,type:"monotone"})]})})})]})}const q=(r,n,a)=>r.map(t=>t.id===n?a(t):t),T=Qe()(Ge((r,n)=>({portfolios:[],activePortfolioId:null,createPortfolio:a=>r(t=>{const s={id:crypto.randomUUID(),name:a,holdings:[],valueHistory:[],createdAt:new Date().toISOString()};return{portfolios:[...t.portfolios,s],activePortfolioId:t.activePortfolioId??s.id}}),deletePortfolio:a=>r(t=>{const s=t.portfolios.filter(i=>i.id!==a);let o=t.activePortfolioId;return t.activePortfolioId===a&&(o=s.length>0?s[0].id:null),{portfolios:s,activePortfolioId:o}}),renamePortfolio:(a,t)=>r(s=>({portfolios:q(s.portfolios,a,o=>({...o,name:t}))})),setActivePortfolio:a=>r({activePortfolioId:a}),addHolding:a=>r(t=>{const s=t.activePortfolioId;return s?{portfolios:q(t.portfolios,s,o=>({...o,holdings:[...o.holdings,{...a,id:crypto.randomUUID(),dateAdded:a.dateAdded||new Date().toISOString()}]}))}:t}),updateHolding:(a,t)=>r(s=>{const o=s.activePortfolioId;return o?{portfolios:q(s.portfolios,o,i=>({...i,holdings:i.holdings.map(l=>l.id===a?{...l,...t}:l)}))}:s}),removeHolding:a=>r(t=>{const s=t.activePortfolioId;return s?{portfolios:q(t.portfolios,s,o=>({...o,holdings:o.holdings.filter(i=>i.id!==a)}))}:t}),recordValue:a=>r(t=>{const s=t.activePortfolioId;if(!s)return t;const o=new Date().toISOString().split("T")[0];return{portfolios:q(t.portfolios,s,i=>{const l=i.valueHistory.findIndex(d=>d.date===o);if(l>=0){const d=[...i.valueHistory];return d[l]={date:o,value:a},{...i,valueHistory:d}}return{...i,valueHistory:[...i.valueHistory,{date:o,value:a}]}})}}),getActivePortfolio:()=>{const a=n();return a.portfolios.find(t=>t.id===a.activePortfolioId)}}),{name:"stock-portfolio-storage"})),{Button:B,ConfirmationModal:St,ModalHeader:ge,ModalWrapper:be,TextInput:ve,useModalStore:wt}=await O("lifeforge-ui"),{useMemo:Ct,useState:K}=await O("react");function ye({onCreateFirst:r}){const{open:n}=wt(),[a,t]=K(!1),[s,o]=K(!1),[i,l]=K(!1),[d,f]=K(""),[x,h]=K(null),m=T(g=>g.portfolios),b=T(g=>g.activePortfolioId),p=T(g=>g.createPortfolio),u=T(g=>g.deletePortfolio),y=T(g=>g.renamePortfolio),A=T(g=>g.setActivePortfolio),S=Ct(()=>m.find(g=>g.id===b),[m,b]),M=()=>{d.trim()&&(p(d.trim()),f(""),o(!1),r?.())},w=()=>{x&&d.trim()&&(y(x.id,d.trim()),f(""),h(null),l(!1))},P=g=>{n(St,{title:"Delete Portfolio",description:`Are you sure you want to delete "${g.name}" portfolio? This action cannot be undone.`,confirmationButton:"delete",onConfirm:async()=>{u(g.id)}})},_=g=>{h(g),f(g.name),l(!0),t(!1)},$=m.length>0;return e.jsxs(e.Fragment,{children:[$?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"bg-bg-100 hover:bg-bg-200 dark:bg-bg-800 dark:hover:bg-bg-700 flex items-center gap-2 rounded-lg px-4 py-2 font-medium transition-colors",type:"button",onClick:()=>t(!a),children:[e.jsx(H,{className:"size-5",icon:"tabler:briefcase"}),e.jsx("span",{children:S?.name??"Select Portfolio"}),e.jsx(H,{className:`size-4 transition-transform ${a?"rotate-180":""}`,icon:"tabler:chevron-down"})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>t(!1)}),e.jsxs("div",{className:"bg-bg-50 dark:bg-bg-800 border-bg-200 dark:border-bg-700 absolute top-full left-0 z-50 mt-2 min-w-64 rounded-lg border shadow-lg",children:[e.jsx("div",{className:"p-2",children:m.map(g=>e.jsxs("div",{className:"flex items-center gap-1 p-1",children:[e.jsxs(B,{className:`flex-1 justify-start ${g.id===b?"bg-custom-500/10 text-custom-500":""}`,icon:g.id===b?"tabler:check":"tabler:briefcase",variant:"tertiary",onClick:()=>{A(g.id),t(!1)},children:[e.jsx("span",{className:"font-medium",children:g.name}),e.jsxs("span",{className:"text-bg-500 text-sm font-normal",children:["(",g.holdings.length,")"]})]}),e.jsx(B,{icon:"tabler:pencil",variant:"plain",onClick:c=>{c.stopPropagation(),_(g)}}),m.length>1&&e.jsx(B,{dangerous:!0,icon:"tabler:trash",variant:"plain",onClick:c=>{c.stopPropagation(),P(g),t(!1)}})]},g.id))}),e.jsx("div",{className:"border-bg-200 dark:border-bg-700 border-t p-2",children:e.jsxs("button",{className:"text-custom-500 hover:bg-custom-500/10 flex w-full items-center gap-2 rounded-lg px-3 py-2",type:"button",onClick:()=>{o(!0),t(!1)},children:[e.jsx(H,{className:"size-4",icon:"tabler:plus"}),e.jsx("span",{children:"New Portfolio"})]})})]})]})]}):e.jsx(B,{icon:"tabler:plus",onClick:()=>o(!0),children:"Create Portfolio"}),e.jsxs(be,{isOpen:s,minWidth:"400px",children:[e.jsx(ge,{icon:"tabler:briefcase-plus",title:"Create Portfolio",onClose:()=>{o(!1),f("")}}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(ve,{icon:"tabler:briefcase",label:"Portfolio Name",placeholder:"e.g., Growth Stocks",value:d,onChange:f}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{variant:"secondary",onClick:()=>{o(!1),f("")},children:"Cancel"}),e.jsx(B,{disabled:!d.trim(),icon:"tabler:check",onClick:M,children:"Create"})]})]})]}),e.jsxs(be,{isOpen:i,minWidth:"400px",children:[e.jsx(ge,{icon:"tabler:pencil",title:"Rename Portfolio",onClose:()=>{l(!1),f(""),h(null)}}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(ve,{icon:"tabler:briefcase",label:"Portfolio Name",placeholder:"e.g., Growth Stocks",value:d,onChange:f}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{variant:"secondary",onClick:()=>{l(!1),f(""),h(null)},children:"Cancel"}),e.jsx(B,{disabled:!d.trim(),icon:"tabler:check",onClick:w,children:"Rename"})]})]})]})]})}const{Card:Z}=await O("lifeforge-ui");function Dt({totalValue:r,totalCost:n,dayChange:a,dayChangePercent:t}){const s=r-n,o=n>0?s/n*100:0,i=s>=0,l=a>=0;return e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(Z,{className:"flex flex-col",children:[e.jsx("div",{className:"text-bg-500 mb-1 text-sm",children:"Total Value"}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",r.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),e.jsxs(Z,{className:"flex flex-col",children:[e.jsx("div",{className:"text-bg-500 mb-1 text-sm",children:"Total Cost"}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",n.toLocaleString("en-US",{minimumFractionDigits:2})]})]}),e.jsxs(Z,{className:"flex flex-col",children:[e.jsx("div",{className:"text-bg-500 mb-1 text-sm",children:"Total P/L"}),e.jsxs("div",{className:`flex items-center gap-2 text-2xl font-bold ${i?"text-green-500":"text-red-500"}`,children:[e.jsx(H,{icon:i?"tabler:trending-up":"tabler:trending-down"}),e.jsxs("span",{children:[i?"+":"","$",Math.abs(s).toLocaleString("en-US",{minimumFractionDigits:2})]}),e.jsxs("span",{className:"text-sm",children:["(",i?"+":"",o.toFixed(2),"%)"]})]})]}),e.jsxs(Z,{className:"flex flex-col",children:[e.jsx("div",{className:"text-bg-500 mb-1 text-sm",children:"Day Change"}),e.jsxs("div",{className:`flex items-center gap-2 text-2xl font-bold ${l?"text-green-500":"text-red-500"}`,children:[e.jsx(H,{icon:l?"tabler:arrow-up":"tabler:arrow-down"}),e.jsxs("span",{children:[l?"+":"","$",Math.abs(a).toLocaleString("en-US",{minimumFractionDigits:2})]}),e.jsxs("span",{className:"text-sm",children:["(",l?"+":"",t.toFixed(2),"%)"]})]})]})]})}const{useQueries:je,useQuery:Ot}=await O("@tanstack/react-query"),{Button:Ne,ModuleHeader:Pe}=await O("lifeforge-ui"),{useEffect:It,useMemo:R,useState:ee}=await O("react"),ke=[{symbol:"SPY",name:"S&P 500"},{symbol:"QQQ",name:"NASDAQ 100"},{symbol:"DIA",name:"Dow Jones"}],Lt=["1W","1M","3M","YTD","1Y","ALL"];function Bt(){const[r,n]=ee(!1),[a,t]=ee("SPY"),[s,o]=ee("1M"),[i,l]=ee(null),d=T(c=>c.portfolios),f=T(c=>c.activePortfolioId),x=T(c=>c.addHolding),h=T(c=>c.removeHolding),m=T(c=>c.recordValue),b=T(c=>c.updateHolding),p=R(()=>d.find(c=>c.id===f),[d,f]),u=p?.holdings??[];p?.valueHistory;const y=je({queries:u.map(c=>re.getQuote.input({symbol:c.symbol}).queryOptions({refetchInterval:6e4,enabled:!!c.symbol,retry:0}))}),A=je({queries:u.map(c=>re.getStock.input({symbol:c.symbol}).queryOptions({enabled:!!c.symbol,staleTime:3e5}))}),S=Ot(re.getStock.input({symbol:a}).queryOptions({enabled:u.length>0,staleTime:3e5})),M=R(()=>u.map((c,v)=>{const j=y[v]?.data;return{...c,currentPrice:j?.price??c.avgCost,change:j?.change??0,changePercent:j?.changePercent??0}}),[u,y]),w=R(()=>{let c=0,v=0,k=0;for(const N of M)c+=N.shares*N.currentPrice,v+=N.shares*N.avgCost,k+=N.shares*N.change;const j=c>0?k/(c-k)*100:0;return{totalValue:c,totalCost:v,dayChange:k,dayChangePercent:j}},[M]);It(()=>{w.totalValue>0&&m(w.totalValue)},[w.totalValue,m]);const P=R(()=>{const c=new Date,v=new Date;switch(s){case"1W":v.setDate(c.getDate()-7);break;case"1M":v.setMonth(c.getMonth()-1);break;case"3M":v.setMonth(c.getMonth()-3);break;case"YTD":v.setMonth(0,1);break;case"1Y":v.setFullYear(c.getFullYear()-1);break;case"ALL":return null;default:v.setMonth(c.getMonth()-1)}return v.toISOString().split("T")[0]},[s]),_=R(()=>[...S.data?.data??[]].reverse().filter(k=>P?k.date>=P:!0).map(k=>({date:k.date,value:k.close})),[S.data,P]),$=R(()=>{if(!A.every(N=>N.data)||u.length===0)return[];const v=new Map;u.forEach((N,I)=>{const F=A[I]?.data?.data??[];for(const C of F)v.has(C.date)||v.set(C.date,new Map),v.get(C.date).set(N.symbol,C.close)});const k=Array.from(v.keys()).sort((N,I)=>new Date(N).getTime()-new Date(I).getTime()),j=[];for(const N of k){if(P&&N<P)continue;let I=0;const F=v.get(N);for(const C of u)if(C.dateAdded.split("T")[0]<=N){const X=F.get(C.symbol);X!==void 0&&(I+=C.shares*X)}I>0&&j.push({date:N,value:I})}return j},[u,A,P]),g=y.some(c=>c.isLoading);return d.length===0?e.jsxs("div",{className:"animate-[fadeSlideIn_0.3s_ease-out]",children:[e.jsx(Pe,{title:"Portfolio"}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"bg-bg-200 dark:bg-bg-700 flex size-24 items-center justify-center rounded-full",children:e.jsx(H,{className:"text-bg-400 size-12",icon:"tabler:briefcase"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("h3",{className:"mb-1 text-lg font-semibold",children:"No Portfolios Yet"}),e.jsx("p",{className:"text-bg-500 mb-4 max-w-sm",children:"Create your first portfolio to start tracking your virtual holdings."}),e.jsx(ye,{})]})]})]}):e.jsxs("div",{className:"flex flex-1 animate-[fadeSlideIn_0.3s_ease-out] flex-col",children:[e.jsx(Pe,{title:"Portfolio"}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx(ye,{}),u.length>0&&e.jsx(Ne,{icon:"tabler:plus",onClick:()=>n(!0),children:"Add Holding"})]}),u.length===0?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"bg-bg-200 dark:bg-bg-700 flex size-24 items-center justify-center rounded-full",children:e.jsx(H,{className:"text-bg-400 size-12",icon:"tabler:chart-pie"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("h3",{className:"mb-1 text-lg font-semibold",children:"No Holdings Yet"}),e.jsx("p",{className:"text-bg-500 mb-4 max-w-sm",children:"Start building your virtual portfolio by adding your first stock holding."}),e.jsx(Ne,{icon:"tabler:plus",onClick:()=>n(!0),children:"Add Your First Holding"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Dt,{dayChange:w.dayChange,dayChangePercent:w.dayChangePercent,totalCost:w.totalCost,totalValue:w.totalValue}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-bg-500 text-sm",children:"Compare:"}),e.jsx("div",{className:"bg-bg-200 dark:bg-bg-700 flex rounded-lg p-0.5",children:ke.map(c=>e.jsx("button",{className:`rounded px-2.5 py-1 text-xs font-medium transition-colors ${a===c.symbol?"bg-custom-500 text-white shadow-sm":"text-bg-500 hover:text-bg-700 dark:hover:text-bg-300"}`,type:"button",onClick:()=>t(c.symbol),children:c.name},c.symbol))})]}),e.jsx("div",{className:"bg-bg-200 dark:bg-bg-700 flex rounded-lg p-0.5",children:Lt.map(c=>e.jsx("button",{className:`rounded px-2.5 py-1 text-xs font-medium transition-colors ${s===c?"bg-bg-50 text-bg-900 dark:bg-bg-800 dark:text-bg-100 shadow-sm":"text-bg-500 hover:text-bg-700 dark:hover:text-bg-300"}`,type:"button",onClick:()=>o(c),children:c},c))})]}),e.jsx(At,{benchmarkData:_,benchmarkSymbol:ke.find(c=>c.symbol===a)?.name??a,error:S.error,isLoading:S.isLoading,portfolioData:$,portfolioName:p?.name??"My Portfolio",range:s})]}),e.jsx(st,{holdings:M,isLoading:g,onEdit:c=>l(c),onRemove:h})]}),e.jsx(Je,{isOpen:r,onAdd:x,onClose:()=>n(!1)}),e.jsx(tt,{holding:i,isOpen:i!==null,onClose:()=>l(null),onSave:b})]})}export{Bt as default};
